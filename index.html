<!--
爱你一万年表白源码（修复完善版）
首发于孟坤博客（http://mkblog.cn）
-->
<!DOCTYPE html>
<html><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <title> 给最特别的你 </title>
    
    <link type="text/css" rel="stylesheet" href="./default.css">
    <link rel="stylesheet" type="text/css" href="style.css"/>
    <script type="text/javascript" src="./jquery.js"></script>
    <script type="text/javascript" src="./jscex.js"></script>
    <script type="text/javascript" src="./jscex-parser.js"></script>

</head>
<body>
    <!-- 背景音乐部分 -->
    <audio id="loveBgm" src="./bgm.mp3" loop="loop"></audio>  
    
	<div id="main">
		<div class="iw_wrapper">
			<ul class="iw_thumbs masonry" id="iw_thumbs" style="position: relative; height: 792px;">
				<li class="masonry-brick" style="position: absolute; top: 0px; left: 0px;"><img src="images/thumbs/1.jpg" data-img="images/full/1.jpg" alt="Thumb1"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 0px; left: 126px;"><img src="images/thumbs/2.jpg" data-img="images/full/2.jpg" alt="Thumb2"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 0px; left: 252px;"><img src="images/thumbs/3.jpg" data-img="images/full/3.jpg" alt="Thumb3"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 0px; left: 378px;"><img src="images/thumbs/4.jpg" data-img="images/full/4.jpg" alt="Thumb8"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 72px; left: 0px;"><img src="images/thumbs/5.jpg" data-img="images/full/5.jpg" alt="Thumb9"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 72px; left: 252px;"><img src="images/thumbs/6.jpg" data-img="images/full/6.jpg" alt="Thumb10"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 0px; left: 504px;"><img src="images/thumbs/7.jpg" data-img="images/full/7.jpg" alt="Thumb6"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 47px; left: 504px;"><img src="images/thumbs/8.jpg" data-img="images/full/8.jpg" alt="Thumb7"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 119px; left: 504px;"><img src="images/thumbs/9.jpg" data-img="images/full/9.jpg" alt="Thumb12"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 169px; left: 0px;"><img src="images/thumbs/10.jpg" data-img="images/full/10.jpg" alt="Thumb4"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 186px; left: 504px;"><img src="images/thumbs/11.jpg" data-img="images/full/11.jpg" alt="Thumb5"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 72px; left: 252px;"><img src="images/thumbs/12.jpg" data-img="images/full/12.jpg" alt="Thumb10"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 234px; left: 252px;"><img src="images/thumbs/13.jpg" data-img="images/full/13.jpg" alt="Thumb6"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 235px; left: 504px;"><img src="images/thumbs/14.jpg" data-img="images/full/14.jpg" alt="Thumb7"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 291px; left: 0px;"><img src="images/thumbs/15.jpg" data-img="images/full/15.jpg" alt="Thumb12"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 291px; left: 126px;"><img src="images/thumbs/16.jpg" data-img="images/full/16.jpg" alt="Thumb4"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" style="position: absolute; top: 320px; left: 504px;"><img src="images/thumbs/17.jpg" data-img="images/full/17.jpg" alt="Thumb5"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" ><img src="images/thumbs/18.jpg" data-img="images/full/18.jpg" alt="Thumb5"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
				<li class="masonry-brick" ><img src="images/thumbs/19.jpg" data-img="images/full/19.jpg" alt="Thumb5"><div><h2>仙女下凡</h2><p>尹军华喜欢淩曉玲</p></div></li>
			</ul>
		</div>
		<div id="iw_ribbon" class="iw_ribbon" style="top: 126px; left: auto; right: 0px; display: block; width: 0%; opacity: 0.8; height: 126px; margin-top: 0px;">
			<span class="iw_close" style="display: none;"></span>
			<span class="iw_zoom" style="display: none;"></span>
		</div>
        <div id="error">
            本页面采用HTML5编辑，目前您的浏览器无法显示，请换成(<a href="http://dl.360safe.com/netunion/20140425/360se+14478+n4a1de2568d.exe">360</a>)
            或者火狐(<a href="http://firefox.com.cn/download/">Firefox</a>)浏览器，或者其他游览器的最新版本。
        </div>
		<div id="wrap">
			<div id="text">
				<div id="code">
					<span class="say">初會：<span id="name"></span></span><br>
                    <span class="say"><span id="fist-say">我們就在三月二十六日下午，我去妳們公司測試洋品，我們第壹次見面，那時的妳看起來特別害羞，但是就在此時我已經對妳心動了......由於工作原因我們二個月沒有見面......五月二十六晚上，我們的第壹次在壹起用餐，那是妳們公司和我們公司組織的壹次聯誼，就在那天妳做了壹件事，讓我感覺到心好慌......就在那天我加了妳的微信於是我們開始了微聊，心理提醒自己抓住這次機會.......六月九日，我們約好第壹次出去玩，萊茵小鎮，也是我第壹次拿到妳幾多幾多張的照片，心情美滋滋......後面我送給妳第壹支玫瑰花，妳竟然收下了，我那是覺得心情是無法用言語來表達的美.....</span></span><br>
                    <span class="say">為妳癡狂，累到傷心：後面就想盡辦法去妳們公司，幾乎每天我們下班都在壹起吃飯，把周邊都吃了個遍，還去了石巖，吃了飯做了最不好的事情就是和妳壹起在地下室找車，最愉快的事情就是壹起喝奶茶，壹起去海邊吹風看夜空大海......壹起暢聊以前當下未來......
壹起經歷的肯定不止上面這些，壹時真說不完...好吧......</span><br>
                    <span class="say">親愛的淩曉玲</span>
                    <span class="say"> </span><br>
                    <span class="say"><span class="space"></span><span id="last-say"> 在這段時間我們經歷了不少，妳應該對我有所了解，每次的受約，每次微妳妳都會回我信息，也給了我繼續戀妳的動力與勇氣；借助這個特別的日子，就在今天二零壹八年七月七日我想對妳說，我愛妳，可以做我女友嗎？從此以後我毫無保留的愛妳！疼妳！寵妳！妳願意嗎？
</span></span><br>
                    <span class="say"><span class="space"></span> <span id="my-name"></span></span>
				</div>
			</div>
			<div id="clock-box">
				<span style="color:#666666;"><span style="color:#33CC00;">截至今天我们已经</span> 默默走过了</span>
				<div id="clock"></div>
			</div>
			<canvas id="canvas" width="100%" height="auto"></canvas>
		</div>
	</div>
    <script charset="UTF-8">
    
    function GetQueryString(name)   //获取get参数
    {
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null) 
            return decodeURI(r[2]); 
        return null;
    }
    
    $(function(){
        $("#name").text(GetQueryString("you")); //获取对方的名字
        $("#fist-say").text(GetQueryString("yi"));  //获取第一句话
        $("#last-say").text(GetQueryString("wu"));  //获取最终的话
        $("#my-name").text(GetQueryString("me"));   //获取我的名字
    })
    
    var lover = {};
    lover.info = {
        name: " [点我]", //点开时爱心桃旁边的字
        year: '2018',     //相遇的年份
        month: '05',      //月
        day: '26',        //日
        hour: 0,       //小时
        minute: 0,     //分钟
        second: 0,      //秒
        
        debug: false,   //是否开启调试模式（如果选是，则会弹窗提示为什么加载出错）
    }
  	
    </script>
	
    <script type="text/javascript" src="./jscex-jit.js"></script>
    <script type="text/javascript" src="./jscex-builderbase.js"></script>
    <script type="text/javascript" src="./jscex-async.js"></script>
    <script type="text/javascript" src="./jscex-async-powerpack.js"></script>
    <script type="text/javascript" src="./functions.js" charset="utf-8"></script>
    <script type="text/javascript" src="./love.js" charset="utf-8"></script>
    <script type="text/javascript" src="./canvas.js" charset="utf-8"></script>
    <script src="jquery.masonry.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="jquery.easing.1.3.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
	$(window).load(function(){
		var $iw_thumbs			= $('#iw_thumbs'),
			$iw_ribbon			= $('#iw_ribbon'),
			$iw_ribbon_close	= $iw_ribbon.children('span.iw_close'),
			$iw_ribbon_zoom		= $iw_ribbon.children('span.iw_zoom');
			
			ImageWall	= (function() {
					// window width and height
				var w_dim,
					// index of current image
					current				= -1,
					isRibbonShown		= false,
					isFullMode			= false,
					// ribbon / images animation settings
					ribbonAnim			= {speed : 500, easing : 'easeOutExpo'},
					imgAnim				= {speed : 400, easing : 'jswing'},
					// init function : call masonry, calculate window dimentions, initialize some events
					init				= function() {
						$iw_thumbs.imagesLoaded(function(){
							$iw_thumbs.masonry({
								isAnimated	: true
							});
						});
						getWindowsDim();
						initEventsHandler();
					},
					// calculate window dimentions
					getWindowsDim		= function() {
						w_dim = {
							width	: $(window).width(),
							height	: $(window).height()
						};
					},
					// initialize some events
					initEventsHandler	= function() {
						
						// click on a image
						$iw_thumbs.delegate('li', 'click', function() {
							if($iw_ribbon.is(':animated')) return false;
							
							var $el = $(this);
							
							if($el.data('ribbon')) {
								showFullImage($el);
							}
							else if(!isRibbonShown) {
								isRibbonShown = true;
								
								$el.data('ribbon',true);
								
								// set the current
								current = $el.index();
							
								showRibbon($el);
							}
						});
						
						// click ribbon close
						$iw_ribbon_close.bind('click', closeRibbon);
						
						// on window resize we need to recalculate the window dimentions
						$(window).bind('resize', function() {
									getWindowsDim();
									if($iw_ribbon.is(':animated'))
										return false;
									closeRibbon();
								 })
								 .bind('scroll', function() {
									if($iw_ribbon.is(':animated'))
										return false;
									closeRibbon();
								 });
						
					},
					showRibbon			= function($el) {
						var	$img	= $el.children('img'),
							$descrp	= $img.next();
						
						// fadeOut all the other images
						$iw_thumbs.children('li').not($el).animate({opacity : 0.2}, imgAnim.speed);
						
						// increase the image z-index, and set the height to 100px (default height)
						$img.css('z-index', 100)
							.data('originalHeight',$img.height())
							.stop()
							.animate({
								height 		: '100px'
							}, imgAnim.speed, imgAnim.easing);
						
						// the ribbon will animate from the left or right
						// depending on the position of the image
						var ribbonCssParam 		= {
								top	: $el.offset().top - $(window).scrollTop() - 6 + 'px'
							},
							descriptionCssParam,
							dir;
						
						if( $el.offset().left < (w_dim.width / 2) ) {
							dir = 'left';
							ribbonCssParam.left 	= 0;
							ribbonCssParam.right 	= 'auto';
						}
						else {
							dir = 'right';
							ribbonCssParam.right 	= 0;
							ribbonCssParam.left 	= 'auto';
						}
						
						$iw_ribbon.css(ribbonCssParam)
								  .show()
								  .stop()
								  .animate({width : '100%'}, ribbonAnim.speed, ribbonAnim.easing, function() {
										switch(dir) {
											case 'left' :
												descriptionCssParam		= {
													'left' 			: $img.outerWidth(true) + 'px',
													'text-align' 	: 'left'
												};
												break;
											case 'right' :	
												descriptionCssParam		= {
													'left' 			: '-200px',
													'text-align' 	: 'right'
												};
												break;
										};
										$descrp.css(descriptionCssParam).fadeIn();
										// show close button and zoom
										$iw_ribbon_close.show();
										$iw_ribbon_zoom.show();
								  });
						
					},
					// close the ribbon
					// when in full mode slides in the middle of the page
					// when not slides left
					closeRibbon			= function() {
						isRibbonShown 	= false
						
						$iw_ribbon_close.hide();
						$iw_ribbon_zoom.hide();
						
						if(!isFullMode) {
						
							// current wall image
							var $el	 		= $iw_thumbs.children('li').eq(current);
							
							resetWall($el);
							
							// slide out ribbon
							$iw_ribbon.stop()
									  .animate({width : '0%'}, ribbonAnim.speed, ribbonAnim.easing); 
								  
						}
						else {
							$iw_ribbon.stop().animate({
								opacity		: 0.8,
								height 		: '0px',
								marginTop	: w_dim.height/2 + 'px' // half of window height
							}, ribbonAnim.speed, function() {
								$iw_ribbon.css({
									'width'		: '0%',
									'height'	: '126px',
									'margin-top': '0px'
								}).children('img').remove();
							});
							
							isFullMode	= false;
						}
					},
					resetWall			= function($el) {
						var $img		= $el.children('img'),
							$descrp		= $img.next();
							
						$el.data('ribbon',false);
						
						// reset the image z-index and height
						$img.css('z-index',1).stop().animate({
							height 		: $img.data('originalHeight')
						}, imgAnim.speed,imgAnim.easing);
						
						// fadeOut the description
						$descrp.fadeOut();
	
						// fadeIn all the other images
						$iw_thumbs.children('li').not($el).animate({opacity : 1}, imgAnim.speed);								
					},
					showFullImage		= function($el) {
						isFullMode	= true;
						
						$iw_ribbon_close.hide();
						
						var	$img	= $el.children('img'),
							large	= $img.data('img'),
						
							// add a loading image on top of the image
							$loading = $('<span class="iw_loading"></span>');
						
						$el.append($loading);
						
						// preload large image
						$('<img/>').load(function() {
							var $largeImage	= $(this);
							
							$loading.remove();
							
							$iw_ribbon_zoom.hide();
							
							resizeImage($largeImage);
							
							// reset the current image in the wall
							resetWall($el);
							
							// animate ribbon in and out
							$iw_ribbon.stop().animate({
								opacity		: 1,
								height 		: '0px',
								marginTop	: '63px' // half of ribbons height
							}, ribbonAnim.speed, function() {
								// add the large image to the DOM
								$iw_ribbon.prepend($largeImage);
								
								$iw_ribbon_close.show();
								
								$iw_ribbon.animate({
									height 		: '100%',
									marginTop	: '0px',
									top			: '0px'
								}, ribbonAnim.speed);
							});
						}).attr('src',large);
							
					},
					resizeImage			= function($image) {
						var widthMargin		= 100,
							heightMargin 	= 100,
						
							windowH      	= w_dim.height - heightMargin,
							windowW      	= w_dim.width - widthMargin,
							theImage     	= new Image();
							
						theImage.src     	= $image.attr("src");
						
						var imgwidth     	= theImage.width,
							imgheight    	= theImage.height;
	
						if((imgwidth > windowW) || (imgheight > windowH)) {
							if(imgwidth > imgheight) {
								var newwidth 	= windowW,
									ratio 		= imgwidth / windowW,
									newheight 	= imgheight / ratio;
									
								theImage.height = newheight;
								theImage.width	= newwidth;
								
								if(newheight > windowH) {
									var newnewheight 	= windowH,
										newratio 		= newheight/windowH,
										newnewwidth 	= newwidth/newratio;
								
									theImage.width 		= newnewwidth;
									theImage.height		= newnewheight;
								}
							}
							else {
								var newheight 	= windowH,
									ratio 		= imgheight / windowH,
									newwidth 	= imgwidth / ratio;
								
								theImage.height = newheight;
								theImage.width	= newwidth;
								
								if(newwidth > windowW) {
									var newnewwidth 	= windowW,
										newratio 		= newwidth/windowW,
										newnewheight 	= newheight/newratio;
							
									theImage.height 	= newnewheight;
									theImage.width		= newnewwidth;
								}
							}
						}
							
						$image.css({
							'width'			: theImage.width + 'px',
							'height'		: theImage.height + 'px',
							'margin-left'	: -theImage.width / 2 + 'px',
							'margin-top'	: -theImage.height / 2 + 'px'
						});							
					};
					
				return {init : init};	
			})();
		
		ImageWall.init();
	});

    </script>

</body></html>
